# 스레드와 동시성

## 스레드 정의

- 프로세스가 할당받은 자원을 이용하는 실행의 단위
- 어떤 프로그램 내에서 특히 프로세스ㅡ 내에서 실행되는 흐름의 단위
- 한 프로세스 내에서 동작되는 여러 실행 흐름으로 프로세스 내의 Heap, Data, Code 영역을 공유
- 하나의 프로세스를 다수의 실행 단위인 스레드로 구분하여, 자원을 공유하고 자원의 생성과 관리의 중복성을 최소화하여 수행 능력을 향상시키는 것을 멀티스레딩이라고 함.
- 이 경우 각각의 스레드는 독립적인 작업을 수행해야 하기 때문에 각자의 스택과 PC 레지스터 값을 가지고 있음

## 프로세스와 스레드의 차이

- 프로세스는 운영체제에서 할당하는 작업의 단위 노드나 웹브라우저같은 프로그램은 개별적인 프로세스이다.프로세스 간에는 메모리등의 자원을공유하지 안음

- 스래드는 프로세스 내에서 실행되는 흐름의 단위 프로세스는 스래드를 여러개 생성하여 작업을 동시에 처리할숭 있음 스레드들은 부모 프로세스의 자원을 공유 같은 주소의메모리에 접근이가능하므로 데이터를 공유
- 노드를 생성하면 프로새스 하나가 생성 이떄 내부적으로 스레드를 여러개 생성,그중 제어할수 있는 스레드는 하나
- 언틋보면 여러개의 일을 동시에 처리할수 있는 멀티스레드가 싱글스레드 보다 좋아보일수 있음

## 싱글스레드

- 스레드 하나가 일을처리

##

- 자원 접근데 대한 동기화를 신경쓰지 않아도 된다.
- 여러개의 스레드가 공유된 자원을 사용할 경우, 각 스레드가 원하는 결과를 얻게 하려면 공용 자원에 대한 접근이 통제되어야 하며, 이 작업은 프로그래머에게 많은 노력을 요구하고 많은 비용을 발생시킨다. 단일 스레드 모델에서는 이러한 작업이 필요하지 않다.
- 작업전환 작업을 요구하지 않는다.
- 작업전환은 여러 개의 프로세스가 하나의 프로세서를 공유할 때 발생하는 작업으로 많은 비용을 필요로 한다.

##

- 여러 개의 CPU를 활용하지 못한다.
- 프로세서를 최대한 활용하게 하려면 cluster 모듈을 사용하거나, 외부에서 여러 개의 프로그램 인스턴스를 실행시키는 방법을 사용해야 한다.
- 두 개의 작업을 하나의 스레드로 처리하는 경우와, 두 개의 스레드로 처리하는 경우를 가정했을 때, 후자의 경우는 짧은 시간 동안 2개의 스레드가 번갈아가면서 작업을 수행한다. 그래서 동시에 두 작업이 처리되는 것과 같이 느끼게 된다.
- 하지만 오히여 두 개의 스레드로 작업한 시간이 싱글스레드로 작업한 시간보다 더 걸릴 수도 있는데, 그 이유는 스레드 간의 작업전환(context switching)에 시간이 걸리기 때문이다.
- 따라서 단순히 CPU만을 사용하는 계산작업이라면, 오히려 멀티스레드보다 싱글스레드로 프로그래밍하는 것이 더 효율적이다.

## 멀티스레드

- 여러개의 스레드가 각자의 일을 처리 빈 스레드가 발생할수 있음 스레드 처리에도 비용발생
- 프로그램을 다수의 실행 단위로 나누어 실행.
- 프로세스 내에서 자원을 공유하여 자원 생성과 관리의 중복을 최소화
- 서버가 많은 요청을 효율적으로 수행할 수 있는 환경을 제공
- 각각의 스레드가 고유의 레지스터와 스택으로 표현됨.

##

- 새로운 프로세스를 생성하는 것보다 기존 프로세스에서 스레드를 생성하는 것이 빠르다.
- 프로세스의 자원과 상태를 공유하여 효율적으로 운영이 가능하다.
- 프로세스의 작업전환보다 스레드의 작업전환이 더 빠르다.

##

- 하나의 스레드만 실행중일 때는 실행시간이 오히려 지연될 수 있다.
- 멀티 스레딩을 위해 운영체제의 지원이 필요하다.
- 스레드 스케쥴링을 신경써야 한다.

## 멀티 프로세싱

- 멀티 스레드가 모두 논 블로킹 방식으로 알을 처리
- 부모-자식 관계라고 해도 자신만의 메모리 영역을 가지게 된다.
- 환경변수와 프로세스 핸들 테이블이 상속 가능할 뿐 결국 독립적인 관계이다.
- fork를 통해 프로세스를 복사한다.
- 유닉스 계열에서 ps 명령어로 현재 수행되고 있는 프로세스를 확인할 수 있다.
- 프로세스 간의 통신을 하려면 IPC(Inter Process Communication; 세마포어, 큐, 공유메모리)를 통해야 한다

##

- 여러 개의 자식 프로세스 중 하나에 문제가 발생하면 그 자식 프로세스만 죽고 다른 프로세스에는 영향이 확산되지 않는다.
- context switching에서의 오버헤드
- context switching 과정에서 캐쉬 메모리 초기화 등 무거운 작업이 진행되고 많은 시간이 소모되는 등의 오버헤드가 발생하게 된다.
- 프로세스는 각각의 독룁된 메모리 영역을 할당 받았기 때문에 프로세스 사이에서 공유하는 메모리가 없어, context switching이 발생하면 캐슁에 있는 모든 데이터를 모두 리셋하고 다시 캐쉬 정보를 불러와야 한다.
- 프로세스 사이의 어렵고 복잡한 통신 기법 (IPC)
- 프로세스는 각각의 독립된 메모리 영역을 할당 받았기 때문에 하나의 프로그램에 속하는 프로세스들 사이의 변수를 공유할 수 없다
- CPU에서 여러 프로세스를 돌아가면서 작업을 처리하는데 이 과정을 context switching이라 한다.
- 구체적으로, 동작 중인 프로세스가 대기를 하면서 해당 프로세스의 상태(context)를 보관하고, 대기하고 있던 다음 순서의 프로세스가 동작하면서 이전에 보관했던 프로세스의 상태를 복구하는 작업을 말한다.
